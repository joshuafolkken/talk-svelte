pre-commit:
  parallel: true
  commands:
    prevent-main-commit:
      run: |
        current_branch=$(git rev-parse --abbrev-ref HEAD)
        if [ "$current_branch" = "main" ]; then
          echo "ğŸš« Error: Direct commits to main branch are not allowed"
          echo "   Please create a new branch and commit there:"
          echo "   git checkout -b feature/your-feature-name"
          exit 1
        else
          echo "âœ… Branch check passed: '$current_branch'"
        fi

    cspell:
      run: npx cspell {staged_files}

    prettier:
      run: npx prettier --check --ignore-unknown {staged_files}

    eslint:
      run: npx eslint {staged_files}

  fail_text: |
    ğŸš« Commit blocked due to quality checks failure
    Please fix the issues above and try again.

    Quick fixes:
    â€¢ Run `npm run format` to auto-format code
    â€¢ Run `npm run lint` to check and fix linting issues
    â€¢ Run `npm run check` to verify TypeScript types

pre-push:
  parallel: true
  commands:
    type-check:
      run: npm run check

    test-unit:
      run: |
        if git diff --name-only HEAD~1 | grep -E '\.(svelte|ts|js|css)$'; then
          npm run test:unit -- --run
        else
          echo "â­ï¸  Skipping unit tests - no frontend changes detected"
        fi

    test-e2e:
      run: |
        if git diff --name-only HEAD~1 | grep -E '\.(svelte|ts|js|css|sql)$'; then
          npm run test:e2e
        else
          echo "â­ï¸  Skipping E2E tests - no frontend changes detected"
        fi

  fail_text: |
    ğŸš« Push blocked due to build or test failures
    Please resolve the issues above before pushing.

    Troubleshooting:
    â€¢ Check build errors: `npm run build`
    â€¢ Run tests locally: `npm run test:unit` and `npm run test:e2e`
